# 1. Выбор темы
Аналог Instagram, направленный на российскую аудиторию. MVP - личный профиль, подписки, лента, комментарии и лайки

# 2. Расчет нагрузки

## 2.1. Аудитория и ее активность

Месячная аудитория Instagram в России на 2021 год составляет 54 млн [(источник)](https://blog.hootsuite.com/instagram-demographics/)  
Дневная аудитория ~30 млн

На 2021 год в среднем, пользователь тратит 29 минут в день [(источник)](https://www.emarketer.com/content/emarketer-reduces-us-time-spent-estimates-for-facebook-and-snapchat)  
## 2.2. Собственные наблюдения
За 3 минуты просмотра ленты я успел просмотреть 30 постов, поставить 5 лайков и оставить один комментарий  

Будем предполагать, что средний пользователь добавляет 15 фотографий в свой профиль за месяц. Взаимодействует с подписками 10 раз в месяц  

## 2.3. Активность на пользователя

### Картинки
Картинки загружаются отдельными запросами на каждый пост. Причем на каждый пост приходится две картинки - аватар автора и сам пост.
```
60 GET / 3 min
```

### Post:
За один запрос на посты приходит 12 штук
```3 GET / 3 min``` Количество лайков, комментариев и сами первые три комментарии приходят вместе с запросом  
```15 POST / month``` Запрос на один пост занимает примерно 200кб (картинка) + 5 кб (другая информация)  

### Profile:
```1 GET / 3min``` Вместе с запросом на профиль приходит информация о подписках.  

Запрос на профиль занимает 40кб + первые посты ~740кб  

### Comment:
```
1 POST / 3 min.
5 GET / 3 min
```

Средняя длина комментариев в социальных сетях 200 символов (200b) [(источник)](https://habr.com/ru/post/72185/)  

### Subscriptions:
```
10 POST / month
```

### Likes:
```
5 POST / 3 min
```

## 2.4. Нагрузка от всей аудитории
Подитожим за сутки, учитывая, что пользователь тратит в сутки в среднем 29 мин:  

Пусть ```k = 30 000 000 users / (24 * 60 * 60) = 347,22 u/s``` - коэффициент, переводящий показатель requests per day для одного человека в rps для всей аудитории. 

### Получение картинок:
Средний вес картинки 200 Кб, аватарки - 4 Кб
```
60 * (29 min / 3 min) * k= 580 requests / day * k = 201 389 rps (19,59 Gb/s)
```

### Post
	GET: 3 * (29 min / 3 min) * k = 29 requests/day * k = 10 069 rps  (19,69 Gb/s)
	POST: 15 / 30 days * k = 0,5 requests/day * k = 174 rps (34,62 Mb/s)
### Profile
	GET: 1 * (29 min / 3 min) * k = 10 requests/day * k = 3 472 rps (32,78 Mb/s)

Прирост месячной аудитории в России за 2021 год согласно [источнику](https://blog.hootsuite.com/instagram-demographics/) составляет 3 млн пользователей.

Это значит, прирост пользователей в день ```3 million / 365 = 8219,14 users/day```  

Тогда rps на post profile будет ~ 1 rps  

### Comments:
За один запрос на комментарии приходит 12 комментариев. Один ответ весит в среднем 4 Kb (with gzip) -> 8kb (without gzip) -> avg comment response size = 8 / 12 = 0,67 Kb
```
GET 5 * 29 min / 3 min * k = 16 782 rps (65,56 Mb/s) (with gzip)
POST 1 * 29 min / 3 min * k = 3 356 rps (2,2 Mb/s) (without gzip)
```

### Likes:
```
POST 5 * 29 min / 3 min * k = 16 782 rps
```

### Subscriptions:
```
POST: 10 * 1 month / 30 days * k = 115 rps
```
Итого:
|Сущность|GET RPS|POST RPS|
|--------|-------|--------|
|Картинки|201 389|175|
|Post|10 069|174|
|Profile|3 472|1|
|Comment|16 782|3 356|
|Subscription|-|115|
|Like|-|16 782|
# 3. Логическая схема БД
![](./media/dbLogic.png)
