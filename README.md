# 1. Выбор темы
Аналог Instagram, направленный на российскую аудиторию. MVP - личный профиль, подписки, лента, комментарии и лайки

# 2. Расчет нагрузки

## 2.1. Аудитория и ее активность

Месячная аудитория Instagram в России на 2021 год составляет 54 млн [(источник)](https://blog.hootsuite.com/instagram-demographics/)  
Дневная аудитория ~30 млн

На 2021 год в среднем, пользователь тратит 29 минут в день [(источник)](https://www.emarketer.com/content/emarketer-reduces-us-time-spent-estimates-for-facebook-and-snapchat)  
## 2.2. Собственные наблюдения
За 3 минуты просмотра ленты было сделано 893 запроса, трафика на 41 мб (с учетом кеширования на клиенте)  

328 - картинки (19.6 мб)  
33 - статика (140 кб)  
598 - XHR из них ~ 60 POST (21.8 мб)   

За это время я успел просмотреть 30 постов, поставить 5 лайков и оставить один комментарий  

Будем предполагать, что средний пользователь добавляет 15 фотографий в свой профиль за месяц. Взаимодействует с подписками 10 раз в месяц  

## 2.3. Активность на пользователя

### Post:
За один запрос на посты приходит 12 штук
```3 GET / 3 min``` Количество лайков, комментариев и сами первые три комментарии приходят вместе с запросом  
```15 POST / month``` Запрос на один пост занимает примерно 200кб (картинка) + 5 кб (другая информация)  

### Profile:
```1 GET / 3min``` Вместе с запросом на профиль приходит информация о подписках.  

Запрос на профиль занимает 40кб + первые посты ~740кб  

### Comment:
```
1 POST / 3 min.
15 GET / 3 min
```

Средняя длина комментариев в социальных сетях 200 символов (200b) [(источник)](https://habr.com/ru/post/72185/)  

### Subscriptions:
```
10 POST / month
1 GET / 3 min
```

### Likes:
```
5 POST / 3 min
```

## 2.4. Нагрузка от всей аудитории
Подитожим за сутки, учитывая, что пользователь тратит в сутки в среднем 29 мин:  

Учтем, что основная активность аудитории в Instagram приходится с 7:00 до 23:00  

Пусть ```k = 30 000 000 users / (24 * 60 * 60) = 817 u/s``` - коэффициент, переводящий показатель requests per day для одного человека в rps для всей аудитории. 

### Получение картинок:
```
328 * (29 min / 3 min) * k= 3170 requests / day * k = 1 100 926 rps
19.6 Mb * (29 min / 3 min) * k = 189,47 Mb / day * k = 65,79 Gb/s
```

### Статика:
Пользователь в среднем заходит в 15 раз в месяц [(источник)](https://popsters.ru/blog/post/svezhie-dannye-o-vk). С учетом того, что статика кешируется на клиенте получим
```
33 * 15 days / 30 days * k= 16,5 requests / day * k = 5 729 rps
140 Kb * 15 days / 30 days * k = 70 Kb / day * k = 24 Mb/s
```
### XHR:
```
598 * (29 min / 3 min) * k = 5780,67 requests/day * k = 2 007 175 rps
21,8 Mb * (29 min / 3 min) * k = 210,73 Mb/day * k = 73,17 Gb/s
```

## Рассмотрим по отдельности:
### Post
	GET: 3 * (29 min / 3 min) * k = 29 requests/day * k = 10 069 rps  (19,69 Gb/s)
	POST: 15 / 30 days * k = 0,5 requests/day * k = 174 rps (34,62 Mb/s)
### Profile
	GET: 1 * (29 min / 3 min) * k = 10 requests/day * k = 3 472 rps (32,78 Mb/s)

Прирост месячной аудитории в России за 2021 год согласно [источнику](https://blog.hootsuite.com/instagram-demographics/) составляет 3 млн пользователей.

Это значит, прирост пользователей в день ```3 million / 365 = 8219,14 users/day```  

Тогда rps на post profile будет ~ 1 rps  

### Comments:
За один запрос на комментарии приходит 12 комментариев. Один ответ весит в среднем 4 Kb (with gzip) -> 8kb (without gzip) -> avg comment size = 8 / 12 = 0,67 Kb
```
GET 15 * 29 min / 3 min * k = 50 347 rps (196,67 Mb/s) (with gzip)
POST 1 * 29 min / 3 min * k = 3 356 rps (2,2 Mb/s) (without gzip)
```

### Likes:
```
POST 5 * 29 min / 3 min * k = 16 782 rps
```
